---
title: "source"
author: "Eugene Ayonga, Selenge Tulga, Shakleen Ishfar, KT Wirth"
date: "2023-11-14"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(dev = "png",
                      dpi = 300,
                      echo = FALSE,
                      cache = TRUE)

library(ggplot2)
library(dplyr)
library(MASS)
```

# Loading the dataset

```{r Loading dataset}
df <- read.csv("Asteroid_Updated.csv")

sprintf("Dataset has %d rows and %d columns", nrow(df), ncol(df))
```

# Mean Inference 7

**Physically hazardous asteroids (PHA) are typically asteroids that are far away from earth.**

```{r Mean_Inference_7 Reading PHA and non-PHA semi-axis values}
df_a_pha <- na.omit(df[c("pha", "a")])

print("Unique PHA types")
unique(df_a_pha$pha)
```

PHA (Physically Hazardous Asteroids) are asteroids that are dangerous for earth. In
the dataset, the column _pha_ signifies whether an asteroid is PHA or not using
"Y" or "N". Let's see how many _non-null_ values we have for each type. 

```{r Mean_Inference_7 Bar chart showing the number of examples of each pha type asteroid}
ggplot(df_a_pha, aes(x=pha, fill=pha)) +
  geom_bar() +
  labs(title = "Bar Chart", subtitle = "PHA distribution") +
  xlab("Physically Hazardous Asteroid (PHA)") +
  ylab("Count") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```

The column __a__ signifies the semi-major axis of an asteroid. The [semi-major axis](https://science.nasa.gov/resource/orbits-and-keplers-laws/) of an asteroid 
is the average orbital distance from the Sun. It is half of the major axis, which 
is the total distance between the closest and farthest points of the asteroidâ€™s 
orbit, also known as the perihelion and aphelion. Let's look at the 5 number summary 
of semi-major axis value for each asteroid type.

```{r Mean_Inference_7 Five number summary of PHA and non-PHA asteroids}
print("Five number summary for PHA type asteroids")
print(fivenum(df_a_pha$a[df_a_pha$pha == "Y"]))

print("Five number summary for non-PHA type asteroids")
print(fivenum(df_a_pha$a[df_a_pha$pha == "N"]))
```

## Dataset Cleaning

There are some samples in the dataset where __pha__ is empty. Let's remove those
samples.

```{r Mean_Inference_7 Remove samples with empty pha value}
df_a_pha <- filter(df_a_pha, pha != '')

print("Unique PHA types")
unique(df_a_pha$pha)
```

Next, we detect and remove the outliers from the samples.

```{r Mean_Inference_7 Remove outliers for a on pha}
get_min_max <- function(values) {
  q1 <- quantile(values, probs = 0.25, na.rm = T)
  q3 <- quantile(values, probs = 0.75, na.rm = T)
  iqr <- q3 - q1
  span <- 1.5 * iqr
  min <- q1 - span
  max <- q3 + span
  return (c(min, max))
}

for (cat in c('Y', 'N')) {
  m <- get_min_max(df_a_pha$a[df_a_pha$pha == cat])
  df_a_pha <- filter(df_a_pha, (pha == cat & a >= m[1] & a <= m[2] |
                                pha != cat))
}

print("After filtering outliers")
sprintf("There are %d semi-axis values for PHA", 
        length(df_a_pha$a[df_a_pha$pha == "Y"]))
sprintf("There are %d semi-axis values for non-PHA", 
        length(df_a_pha$a[df_a_pha$pha == "N"]))
```

Let's see how the data is distributed for PHA and non-PHA using a boxplot.

```{r Mean_Inference_7 Boxplot of PHA and non-PHA a values}
ggplot(df_a_pha, aes(x=pha, y=a, fill=pha)) +
  geom_boxplot() +
  labs(title = "Side by Side Boxplot",
       subtitle = "a by pha") +
  xlab("Physically Hazardous Asteroid (pha)") +
  ylab("Semi-major Axis Value (a)") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```

Let's see the distribution of values of different __pha__ asteroid types.

```{r Mean_Inference_7 Histogram distribution of PHA and non-PHA a values}
ggplot(df_a_pha, aes(x=a, fill=pha)) +
  geom_histogram(aes(y=after_stat(density)), position="dodge", 
                 bins = ceiling(log(length(df_a_pha$a[df_a_pha$pha == "N"]))) + 1) +
  labs(title = "Histogram", 
       subtitle = "Distribution of Semi-major Axis Values") +
  xlab("Semi-major Axis Value (a)") +
  ylab("Distribution Density") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```

Let's check the distribution of the populations against a normal distribution.

```{r Mean_Inference_7 Q-Q plot to compare against normal distribution}
ggplot(df_a_pha, aes(sample=a, color=pha)) +
  stat_qq() +
  stat_qq_line() +
  labs(title = "Quantile-Quantile plot",
       subtitle = "Distribution of Semi-major Axis Values") +
  xlab("Normal distribution") +
  ylab("Semi-major Axis value") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```

## Hypothesis testing

After filtering out sample has more than 30 examples, meaning we can assume that
the normality condition holds according to CLT. We have two populations, which are
asteroids that are PHA and non-PHA. We do not know the population variance for each
population and can't assume that they are equal. So, it makes sense to do a **Welch test.** 
Asteroids that are closer to earth will have a smaller semi-major axis while
asteroids that are further away will have a higher semi-major axis. Essentially,
we are testing to see if PHA type asteroids have a larger semi-major axis than
non-PHA type asteroids. Mathematically, our hypothesis are as follow:

* $\mathbf{H_0}: \mu_y \le \mu_n$
* $\mathbf{H_1}: \mu_y > \mu_n$

Out level of significance is $\alpha = 0.01$.

where $\mu_y$ and $\mu_n$ are mean semi-major axis value for PHA and non-PHA type
asteroids.

```{r Mean_Inference_7 Welch test}
a_ypha <- df_a_pha$a[df_a_pha$pha == 'Y']
a_npha <- df_a_pha$a[df_a_pha$pha == 'N']
t.test(x=a_ypha, y=a_npha, alternative="greater",
       paired=F, var.equal=F, conf.level=1-0.01)
```

We can see that the p-value is 1. Which is way higher than our significance level.
This means we don't have sufficient evidence to reject the null hypothesis. Interestingly,
asteroids that are non-PHA have a very probability of having larger semi-major axis
values. This means that **Physically hazardous asteroids are typically closer to earth.**

# Correlation Inference

**We are more confident about an asteroid's orbital path, the more times we observe it.**

The **condition_code** column stands for orbital condition code. It is also known
as the **U Uncertainty Parameter**. Values range from 0 to 9 on the logarithmic scale 
indicating how well an object's orbit is known.  A value of 0 indicates a well-determined 
orbit, while a value of 9 indicates that there are insufficient observations for 
long-term orbit prediction.

The column **n_obs_used** signifies the number of observations used for a particular
asteroid.

```{r Correlation_Inference_1 Creating view with orbital condition code and observation counts}
df_cc_oc <- na.omit(df[c("condition_code", "n_obs_used")])
```

## Data Cleaning

```{r Correlation_Inference_1 Unique observation counts}
print("Unique condition codes")
print(unique(df_cc_oc$condition_code))
```

Interestingly, there are more than 10 values in condition code column. After searching
online extensively, we were unable to find any information on  these orbits. Hence, 
we come to the conclusion that these are mislabeled. Since they are a very small 
fraction of the total sample size, we can safely remove them. While we're at it, 
let's remove the instances that don't have a condition code at all.

```{r Correlation_Inference_1 Cleaning erroneous condition code}
df_cc_oc <- filter(df_cc_oc, condition_code != '')
df_cc_oc <- filter(df_cc_oc, condition_code != 'D')
df_cc_oc <- filter(df_cc_oc, condition_code != 'E')
sprintf("Sample count after filtering: %d", nrow(df_cc_oc))
```
Let's now observe the number of samples in each of the condition codes in a bar
chart:

```{r Correlation_Inference_1 Barchart showing the distribution of condition codes}
ggplot(df_cc_oc, aes(x=condition_code, fill=condition_code)) +
  geom_bar() +
  labs(title = "Bar Chart", subtitle = "Condition code distribution") +
  xlab("Condition Code") +
  ylab("Count") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```

Let's clean the dataset by removing the outliers.

```{r Correlation_Inference_1 Discarding outliers from condition code}
for (a in unique(df_cc_oc$condition_code)) {
  m <- get_min_max(df_cc_oc$n_obs_used[df_cc_oc$condition_code == a])
  cond <- (df_cc_oc$n_obs_used >= m[1]) & (df_cc_oc$n_obs_used <= m[2])
  df_cc_oc <- df_cc_oc[df_cc_oc$condition_code != a | cond,]
}
```

We can now check the distribution of each condition code's observation counts.

```{r Correlation_Inference_1 Boxplot showing the distribution of observations per condition codes}
ggplot(df_cc_oc, aes(x=condition_code, y=n_obs_used, fill=condition_code)) +
  geom_boxplot() +
  labs(title = "Side by Side Boxplot",
       subtitle = "Observations by Condition code") +
  xlab("Condition code") +
  ylab("Observations") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```

Visually, the lower the condition code, the more observations we have for the
asteroid type.

## Hypothesis test

<!-- TODO: Figure out a way to do the hypothesis  -->

# Mean Inference 9

**NEOs on average have a lower orbital periods than non-NEOs.**

```{r Mean_Inference_9 Create temporary dataframe}
df_neo_per <- na.omit(df[c("neo", "per_y")])
sprintf("Number of examples: %d", nrow(df_neo_per))
```

NEO stands for Near Earth Object. Asteroids that are close to earth are classified 
as NEO asteroids. In the dataset, the column **neo** has values 'Y' and 'N' for asteroids
that are NEO and not NEO respectively. Let's see how many of each type we have in 
our sample

```{r Mean_Inference_9 Count for NEO and non-NEO asteroids}
df_neo_per %>% group_by(neo) %>% summarise(count = n())
```

The [orbital period](https://en.wikipedia.org/wiki/Orbital_period) of an asteroid 
is the amount of time it takes for the asteroid to complete one orbit around the Sun.
The column **per_y** holds the value for orbital periods of each asteroid.

## Data Cleaning

There seems to be 5 samples where the NEO status is blank. Let's remove them.

```{r Mean_Inference_9 Removing blank NEO status samples}
df_neo_per <- filter(df_neo_per, neo != '')
sprintf("Number of examples: %d", nrow(df_neo_per))

```

Now, let's remove outlier values for orbital period for NEO and non-NEO asteroids.

```{r Mean_Inference_9 Removing outliers}
for (a in unique(df_neo_per$neo)) {
  m <- get_min_max(df_neo_per$per_y[df_neo_per$neo == a])
  cond <- (df_neo_per$per_y >= m[1]) & (df_neo_per$per_y <= m[2])
  df_neo_per <- df_neo_per[df_neo_per$neo != a | cond,]
}

df_neo_per %>% group_by(neo) %>% summarise(count = n())
```

We can now check the distribution of orbital periods for NEO and non-NEO objects 
in our sample set.

```{r Mean_Inference_9 Histogram distribution of NEO and non-NEO period values}
ggplot(df_neo_per, aes(x=per_y, fill=neo)) +
  geom_histogram(aes(y=after_stat(density)), position="dodge", 
                 bins = ceiling(log(length(df_a_pha$a[df_a_pha$pha == "N"]))) + 1) +
  labs(title = "StackedHistogram", 
       subtitle = "Distribution of Orbital Periods") +
  xlab("Orbital Period (per_y)") +
  ylab("Distribution Density") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```

From the histogram we can observe that the distribution of orbital period for non-NEO
asteroids are on average higher than NEO asteroids. Let's take a look at a boxplot to
get a better look.

```{r Mean_Inference_9 Boxplot showing the distribution of orbital periods}
ggplot(df_neo_per, aes(x=neo, y=per_y, fill=neo)) +
  geom_boxplot() +
  labs(title = "Side by Side Boxplot",
       subtitle = "Orbital Period by NEO") +
  xlab("Near Earth Object") +
  ylab("Orbital Period") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```

So visually our hypothesis of NEO asteroids having on average a lower orbital period
seems to hold. But let's perform a hypothesis test to see if that's really the case.

## Hypothesis Test

Formally let our hypothesis be the following

* $\mathbf{H_0}: \mu_{neo} > \mu_{not} = \mu_{neo} - \mu_{not} \ge 0$
Meaning, the average orbital period of NEO asteroids are greater than or equal
to the average orbital period of non-NEO asteroids.

* $\mathbf{H_1}: \mu_{neo} \le \mu_{not} = \mu_{neo} - \mu_{not} < 0$
Meaning, the average orbital period of NEO asteroids are less than the average 
orbital period of non-NEO asteroids.

and our significance level $\alpha = 0.01$.

We have 2 populations where we don't know the population variance of either and we
can't assume the variances are equal. So, we'll be doing a Welch test.

```{r Mean_Inference_9 Welch test}
t.test(x = df_neo_per$per_y[df_neo_per$neo == 'Y'],
       y = df_neo_per$per_y[df_neo_per$neo == 'N'],
       alternative = "less", paired = F,
       var.equal = F, conf.level = 1 - 0.01)
```

The p-value is much smaller than our significance level. Thus, we have sufficient
evidence to conclude that the average orbital period of NEO asteroids are less than
the average orbital period of non-NEO asteroids.

# Variance Inference 7

**NEOs have lower variance in diameter than non-NEOs.**

```{r Var_Inference_7 Reading NEO and non-NEO diameter values}
df_neo_d <- na.omit(df[c("neo", "diameter")])

sprintf("There are %d diameter values for NEO asteroids", 
        length(df_neo_d$diameter[df_neo_d$neo == "Y"]))
sprintf("There are %d diameter values for non-NEO asteroids", 
        length(df_neo_d$diameter[df_neo_d$neo == "N"]))
```

The __diameter__ column holds values for the diameter of an asteroid. We want to 
know if the diameter of Near Earth Object asteroids vary less than non-NEO asteroids.

## Data Cleaning

First we get rid of diameter values that are outliers.

```{r Var_Inference_7 Remove outliers for diameter on neo}
get_min_max <- function(values) {
  q1 <- quantile(values, probs = 0.25, na.rm = T)
  q3 <- quantile(values, probs = 0.75, na.rm = T)
  iqr <- q3 - q1
  span <- 1.5 * iqr
  min <- q1 - span
  max <- q3 + span
  return (c(min, max))
}

for (cat in c('Y', 'N')) {
  m <- get_min_max(df_neo_d$diameter[df_neo_d$neo == cat])
  df_neo_d <- filter(df_neo_d, (neo == cat & diameter >= m[1] & diameter <= m[2] |
                                neo != cat))
}

print("After filtering outliers")
sprintf("There are %d diameter values for NEO asteroids", 
        length(df_neo_d$diameter[df_neo_d$neo == "Y"]))
sprintf("There are %d diameter values for non-NEO asteroids", 
        length(df_neo_d$diameter[df_neo_d$neo == "N"]))
```

Now let's look at the distribution of diagrams for each type of asteroids

```{r Var_Inference_7 Distribution of NEO and non-NEO asteroid diameters}
bins = ceiling(log(length(df_neo_d$diameter[df_neo_d$neo == "N"]))) + 1

ggplot(df_neo_d, aes(x=diameter, fill=neo)) +
  geom_histogram(aes(y=after_stat(density)), position="dodge",
                 bins = bins) +
  labs(title = "Stacked Histogram",
       subtitle = "Distribution of Diameters") +
  xlab("Diameter (diameter)") +
  ylab("Distribution Density") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```

It looks like the diameter values for non-NEOs tend to vary more than the NEO
asteroids. Let's look at a boxplot to better understand this:

```{r Var_Inference_7 Boxplot of NEO and non-NEO diameter values}
ggplot(df_neo_d, aes(x=neo, y=diameter, fill=neo)) +
  geom_boxplot() +
  labs(title = "Side by Side Boxplot",
       subtitle = "diameter by neo") +
  xlab("Near Earth Object (neo)") +
  ylab("Diameter (diameter)") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```

Visually, we can say that the variance is different. Let's prove this with a two-way
variance test.

## Inference Test

Let,

  * $s_{neo}^2$ be the variance of NEO asteroids.
  * $s_{non\_neo}^2$ be the variance of non-NEO asteroids.
    
then our hypothesis is as follows

  * $\mathbf{H_0}: s_{neo}^2 \ge s_{non\_neo}^2$
  * $\mathbf{H_1}: s_{neo}^2 < s_{non\_neo}^2$

and let our level of significance be $\alpha = 0.01$.

```{r Var_Inference_7 Two-way variance test}
var.test(x=df_neo_d$diameter[df_neo_d$neo == "Y"],
         y=df_neo_d$diameter[df_neo_d$neo == "N"],
         conf.level = 0.01,
         alternative = "less")
```

The p-value is much lower than our significance value. So we can say with 99\%
confidence that we can reject the null hypothesis. Meaning, the variance for diameters
of NEO asteroids are less than non-NEO asteroids.




























