---
title: "source"
author: "Eugene Ayonga, Selenge Tulga, Shakleen Ishfar, KT Wirth"
date: "2023-11-14"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(dev = "png",
                      dpi = 300,
                      echo = FALSE,
                      cache = TRUE)

library(ggplot2)
library(dplyr)
library(MASS)
```

# Loading the dataset

```{r Loading dataset}
df <- read.csv("Asteroid_Updated.csv")

sprintf("Dataset has %d rows and %d columns", nrow(df), ncol(df))
```

# Mean Inference 7

**Physically hazardous asteroids (PHA) are typically asteroids that are far away from earth.**

```{r Reading PHA and non-PHA semi-axis values}
df_a_pha <- na.omit(df[c("pha", "a")])

print("Unique PHA types")
unique(df_a_pha$pha)
```

PHA (Physically Hazardous Asteroids) are asteroids that are dangerous for earth. In
the dataset, the column _pha_ signifies whether an asteroid is PHA or not using
"Y" or "N". Let's see how many _non-null_ values we have for each type. 

```{r Bar chart showing the number of examples of each pha type asteroid}
ggplot(df_a_pha, aes(x=pha, fill=pha)) +
  geom_bar() +
  labs(title = "Bar Chart", subtitle = "PHA distribution") +
  xlab("Physically Hazardous Asteroid (PHA)") +
  ylab("Count") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```

The column __a__ signifies the semi-major axis of an asteroid. The [semi-major axis](https://science.nasa.gov/resource/orbits-and-keplers-laws/) of an asteroid 
is the average orbital distance from the Sun. It is half of the major axis, which 
is the total distance between the closest and farthest points of the asteroidâ€™s 
orbit, also known as the perihelion and aphelion. Let's look at the 5 number summary 
of semi-major axis value for each asteroid type.

```{r Five number summary of PHA and non-PHA asteroids}
print("Five number summary for PHA type asteroids")
print(fivenum(df_a_pha$a[df_a_pha$pha == "Y"]))

print("Five number summary for non-PHA type asteroids")
print(fivenum(df_a_pha$a[df_a_pha$pha == "N"]))
```

## Dataset Cleaning

There are some samples in the dataset where __pha__ is empty. Let's remove those
samples.

```{r Remove samples with empty pha value}
df_a_pha <- filter(df_a_pha, pha != '')

print("Unique PHA types")
unique(df_a_pha$pha)
```

Next, we detect and remove the outliers from the samples.

```{r Remove outliers for a on pha}
get_min_max <- function(values) {
  q1 <- quantile(values, probs = 0.25, na.rm = T)
  q3 <- quantile(values, probs = 0.75, na.rm = T)
  iqr <- q3 - q1
  span <- 1.5 * iqr
  min <- q1 - span
  max <- q3 + span
  return (c(min, max))
}

for (cat in c('Y', 'N')) {
  m <- get_min_max(df_a_pha$a[df_a_pha$pha == cat])
  df_a_pha <- filter(df_a_pha, (pha == cat & a >= m[1] & a <= m[2] |
                                pha != cat))
}

print("After filtering outliers")
sprintf("There are %d semi-axis values for PHA", 
        length(df_a_pha$a[df_a_pha$pha == "Y"]))
sprintf("There are %d semi-axis values for non-PHA", 
        length(df_a_pha$a[df_a_pha$pha == "N"]))
```

Let's see how the data is distributed for PHA and non-PHA using a boxplot.

```{r Boxplot of PHA and non-PHA a values}
ggplot(df_a_pha, aes(x=pha, y=a, fill=pha)) +
  geom_boxplot() +
  labs(title = "Side by Side Boxplot",
       subtitle = "a by pha") +
  xlab("Physically Hazardous Asteroid (pha)") +
  ylab("Semi-major Axis Value (a)") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```

Let's see the distribution of values of different __pha__ asteroid types.

```{r Histogram distribution of PHA and non-PHA a values}
ggplot(df_a_pha, aes(x=a, fill=pha)) +
  geom_histogram(aes(y=after_stat(density)), position="stack", 
                 bins = ceiling(log(length(df_a_pha$a[df_a_pha$pha == "N"]))) + 1) +
  labs(title = "Stacked Histogram", 
       subtitle = "Distribution of Semi-major Axis Values") +
  xlab("Semi-major Axis Value (a)") +
  ylab("Distribution Density") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```

Let's check the distribution of the populations against a normal distribution.

```{r Q-Q plot to compare against normal distribution}
ggplot(df_a_pha, aes(sample=a, color=pha)) +
  stat_qq() +
  stat_qq_line() +
  labs(title = "Quantile-Quantile plot",
       subtitle = "Distribution of Semi-major Axis Values") +
  xlab("Normal distribution") +
  ylab("Semi-major Axis value") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```

## Hypothesis testing

After filtering out sample has more than 30 examples, meaning we can assume that
the normality condition holds according to CLT. We have two populations, which are
asteroids that are PHA and non-PHA. We do not know the population variance for each
population and can't assume that they are equal. So, it makes sense to do a **Welch test.** 
Asteroids that are closer to earth will have a smaller semi-major axis while
asteroids that are further away will have a higher semi-major axis. Essentially,
we are testing to see if PHA type asteroids have a larger semi-major axis than
non-PHA type asteroids. Mathematically, our hypothesis are as follow:

* $\mathbf{H_0}: \mu_y \le \mu_n$
* $\mathbf{H_1}: \mu_y > \mu_n$

Out level of significance is $\alpha = 0.01$.

where $\mu_y$ and $\mu_n$ are mean semi-major axis value for PHA and non-PHA type
asteroids.

```{r Welch test for a on pha}
a_ypha <- df_a_pha$a[df_a_pha$pha == 'Y']
a_npha <- df_a_pha$a[df_a_pha$pha == 'N']
t.test(x=a_ypha, y=a_npha, alternative="greater",
       paired=F, var.equal=F, conf.level=1-0.01)
```

We can see that the p-value is 1. Which is way higher than our significance level.
This means we don't have sufficient evidence to reject the null hypothesis. Interestingly,
asteroids that are non-PHA have a very probability of having larger semi-major axis
values. This means that **Physically hazardous asteroids are typically closer to earth.**

# Correlation Inference

**We are more confident about an asteroid's orbital path, the more times we observe it.**

The **condition_code** column stands for orbital condition code. It is also known
as the **U Uncertainty Parameter**. Values range from 0 to 9 on the logarithmic scale 
indicating how well an object's orbit is known.  A value of 0 indicates a well-determined 
orbit, while a value of 9 indicates that there are insufficient observations for 
long-term orbit prediction.

The column **n_obs_used** signifies the number of observations used for a particular
asteroid.

```{r Creating view with orbital condition code and observation counts}
df_cc_oc <- na.omit(df[c("condition_code", "n_obs_used")])
```

## Data Cleaning

```{r Unique observation counts}
print("Unique condition codes")
print(unique(df_cc_oc$condition_code))
```

Interestingly, there are more than 10 values in condition code column. After searching
online extensively, we were unable to find any information on  these orbits. Hence, 
we come to the conclusion that these are mislabeled. Since they are a very small 
fraction of the total sample size, we can safely remove them. While we're at it, 
let's remove the instances that don't have a condition code at all.

```{r Cleaning erroneous condition code}
df_cc_oc <- filter(df_cc_oc, condition_code != '')
df_cc_oc <- filter(df_cc_oc, condition_code != 'D')
df_cc_oc <- filter(df_cc_oc, condition_code != 'E')
sprintf("Sample count after filtering: %d", nrow(df_cc_oc))
```
Let's now observe the number of samples in each of the condition codes in a bar
chart:

```{r Barchart showing the distribution of condition codes}
ggplot(df_cc_oc, aes(x=condition_code, fill=condition_code)) +
  geom_bar() +
  labs(title = "Bar Chart", subtitle = "Condition code distribution") +
  xlab("Condition Code") +
  ylab("Count") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```

Let's clean the dataset by removing the outliers.

```{r Discarding outliers from condition code}
for (a in unique(df_cc_oc$condition_code)) {
  m <- get_min_max(df_cc_oc$n_obs_used[df_cc_oc$condition_code == a])
  cond <- (df_cc_oc$n_obs_used >= m[1]) & (df_cc_oc$n_obs_used <= m[2])
  df_cc_oc <- df_cc_oc[df_cc_oc$condition_code != a | cond,]
}
```

We can now check the distribution of each condition code's observation counts.

```{r Boxplot showing the distribution of observations per condition codes}
ggplot(df_cc_oc, aes(x=condition_code, y=n_obs_used, fill=condition_code)) +
  geom_boxplot() +
  labs(title = "Side by Side Boxplot",
       subtitle = "Observations by Condition code") +
  xlab("Condition code") +
  ylab("Observations") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```

Visually, the lower the condition code, the more observations we have for the
asteroid type.

## Hypothesis test

<!-- TODO: Figure out a way to do the hypothesis  -->
